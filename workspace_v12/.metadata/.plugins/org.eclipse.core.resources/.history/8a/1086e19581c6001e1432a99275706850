#include <msp430.h>
#include <driverlib.h>
#include <Board.h>


#include <msp430.h>
#include "board.h" // Make sure to include your board configuration header file

void setupPWM() {
    // Configure GPIO pin for PWM output (Adjust as necessary based on your fan connection)
    // Example: Using GPIO_PORT_LED1 and GPIO_PIN_LED1 for PWM output
    P1DIR |= GPIO_PIN_LED1; // Set the pin to output direction
    P1SEL |= GPIO_PIN_LED1; // Select PWM function for the pin (Adjust SEL to SEL0 or SEL1 as per your MCU's datasheet)

    // Configure Timer_A for PWM (Adjust Timer_A settings based on your specific model)
    TA0CTL = TASSEL_2 + MC_1; // SMCLK as source, Up mode
    TA0CCTL1 = OUTMOD_7; // Reset/Set mode
    TA0CCR0 = 1000 - 1; // PWM Period, adjust for frequency
    TA0CCR1 = 500; // Initial duty cycle 50%
}

void setFanSpeed(unsigned int speed) {
    // Adjust duty cycle for speed control
    if (speed > 100) speed = 100;
    TA0CCR1 = (TA0CCR0 + 1) * speed / 100 - 1;
}

int main(void) {
    WDTCTL = WDTPW | WDTHOLD; // Stop watchdog timer
    setupPWM(); // Setup PWM for fan control

    // Example: Vary speed in a loop
    while(1) {
        for(unsigned int speed = 0; speed <= 100; speed += 10) {
            setFanSpeed(speed); // Set fan speed
            __delay_cycles(1000000); // Delay to observe the change
        }
    }
}



